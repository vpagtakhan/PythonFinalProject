<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winnipeg Weather Data</title>
</head>
<body>
    <!--UI TITLE-->
    <header>Winnipeg Weather Data</header>

    <nav>
        <button onclick="showDownloadUI()">Download Weather Data</button>
        <button onclick="UpdateDataForm()">Update Weather Data</button>
        <button onclick="WeatherPlotForm()">Weather Data Graphs</button>
    </nav>
    <div class="container" id="content-area">
        <h2>Welcome!</h2>
        <p>Select an option from the navigation bar to get started!</p>
    </div>
    <script>
        function showDownloadUI() {
            document.getElementById("content-area").innerHTML = `
            <h2>Download Weather Data</h2>

            <div class="panel">
                <label>Start Year</label>
                <input type="number" id="start-year"><br><br>

                <label>End Year</label>
                <input type="number" id="end-year"><br><br>

                <label>File Format:</label>
                <select id="file-format">
                    <option value="csv">CSV</option>
                    <option value="json">JSON</option>
                </select><br><br>

                <button onclick="requestDownload()">Download File</button>
            </div>
            `;
        }

        function requestDownload() {
            const startYear = document.getElementById("start-year").value;
            const endYear = document.getElementById("end-year").value;
            const format = document.getElementById("file-format").value;

            if (!startYear || !endYear) {
                alert("Please enter both start and end years")
                return;
            }

            window.location.href = `/download_data?start_year=${encodeURIComponent(startYear)}&end_year=${encodeURIComponent(endYear)}&format=${encodeURIComponent(format)}`;
        }

        function WeatherPlotForm() {
        document.getElementById("content-area").innerHTML = `
        <h2>Weather Plot Data</h2>
        <div class="row">
            <div class="form-section">
                <h3>Box Plot - Year Range</h3>
                <label>Start Year</label>
                <input type="number" id="box-start-year"><br><br>

                <label>End Year</label>
                <input type="number" id="box-end-year"><br><br>

                <button onclick="requestBoxPlot()">Generate Box Plot</button>
            </div>

            <div class="form-section">
                <h3>Line Plot - Year and Month</h3>
                <label>Year:</label>
                <input type="number" id="plot-year"><br><br>

                <label>Month (1-12):</label>
                <input type="number" id="plot-month"><br><br>

                <button onclick="requestLinePlot()">Generate Line Plot</button>
            </div>
        </div>
            `;
        }

        function requestBoxPlot() {
            const startYear = document.getElementById("box-start-year").value;
            const endYear = document.getElementById("box-end-year").value;

            if (!startYear || !endYear) {
                alert("Please enter both start and end years.");
                return;
            }

            window.open(
                `/plot_box?start_year=${encodeURIComponent(startYear)}&end_year=${encodeURIComponent(endYear)}`,
                "_blank"
            );
        }

        function requestLinePlot() {
            const year = document.getElementById("plot-year").value;
            const month = document.getElementById("plot-month").value;

            if (!year || !month) {
                alert("Please enter both a year and a month (1-12).");
            }

            window.open(
                `/plot_line?year=${encodeURIComponent(year)}&month=${encodeURIComponent(month)}`,
                "_blank"
            );
        }

        function UpdateDataForm() {
            const content = document.getElementById("content-area");

            // Show initial "updating" message
            content.innerHTML = `
                <h2>Update Weather Data</h2>
                <p>Updating weather data...</p>
            `;

            fetch("/update_data")
                .then(response => { 
                    if (!response.ok) {
                        throw new Error("Server returned " + response.status);
                    }
                    return response.text();
                })
                .then(message => {
                    content.innerHTML = `
                        <h2>Update Complete</h2>
                        <p>${message}</p>
                    `;
                })
                .catch(error => {
                    content.innerHTML = `
                        <h2>Error</h2>
                        <p>There was a problem updating weather data: ${error}</p>
                    `;
                });
        }
    </script>
</body>
</html>